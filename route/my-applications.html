{{define "Head"}}
    <title>Mes postulation</title>
    <script src="/static/JobCard.js" type="module"></script>
{{end}}
%end
{{define "Style"}}

main{
    container-type: inline-size;
    .header{
        margin-bottom: .5lh;
        font-size: 1.2rem;
    }
    .container{
        padding: 1rem;
        background-color: white;
        border-radius: 20px;
        border: 1px solid lightgray;
        @container (width <= 677px){
            #favorite-cards-container{
                white-space: nowrap;
                margin-bottom: 2lh;
                overflow-x: scroll;
                scroll-snap-type: x mandatory;
                padding-block: .3rem;
                .favorite-card{
                    display: inline-flex;
                    flex-direction: column;
                    justify-content: center;
                    height: 8lh;
                    padding: 1rem;
                    aspect-ratio: 3/1;
                    margin-right: 1rem;
                    scroll-snap-align: center;
                    margin-bottom: 0;
                    scroll-snap-align: start;
                    &:last-child{
                        margin-right: 0;
                    }
                }
            }
            .card{
                margin-bottom: 1rem;
            }
        }
        @container (width >= 678px){
            #favorite-cards-container, .application{
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            #favorite-cards-container{
                white-space: normal;
                margin-bottom: .5lh;
                .favorite-card{
                    display: block;
                    height: fit-content;
                    width: 100%;
                    padding: 10px;
                }
            }
        }
        #favorite{
            width: 100%;
            #favorite-cards-container{
                width: 100%;
                .favorite-card{
                    border-radius: 10px;
                    border: 1px solid lightgray;
                    background-color: white;
                }
                .favorite-title{
                    font-size: 1rem;
                }
                .favorite-addr{
                    color: #5b5b5b;
                }
                .favorite-addr, .favorite-title{
                    margin-bottom: .3lh;
                }
                .item{
                    display: inline-block;
                    margin-right: .5rem;
                    border-radius: 25px;
                    background-color: var(--primary_color);
                    padding: .3rem .5rem;
                    font-size: .8rem;
                }
                .favorite-noitem{
                    height: 8lh;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 1.1rem;
                }
            }
        }
    }
}

.application{
    .card{
        position: relative;
        gap: .3rem;
        background-color: white;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 0 6px 2px darkgray;
        .title, .application-addr{
            margin-bottom: .3lh;
        }
        .title{
            font-size: 1.1rem;
        }
        .application-footer{
            border-top: 1px solid lightgray;
            padding-top: .3lh;
            display: flex;
            justify-content: space-between;
        }
        .cancelBtn{
            height: 1.5rem;
            padding: 0 5px;
            border-radius: 5px;
            border: 1px solid red;
            color: red;
            font-weight: bold;
        }
        
        .status{
            position: relative;
            font-weight: bold;
            display: flex;
            align-items: center;
            font-size: .8rem;
            text-wrap: nowrap;
        }
    }
}
.waiting::before, .validate::before, .warning::before{
    content: "";
    height: .8rem;
    width: .8rem;
    border-radius: 50%;
    margin-right: .3rem;
}
.waiting::before{
    background-color: rgb(245, 154, 58);
}
.validate::before{
    background-color: #00c749;
}
.warning::before{
    background-color: var(--delete_color);
}

.fade{
    animation: fadeAnimation .3s linear;
}

@keyframes fadeAnimation{
    100%{
       top: calc(-80px - .5rem); 
       opacity: 0;
    }
}

.reorder{
    transition: top .3s linear;
    top: calc(-80px - .5rem);
}

{{end}}
%end
{{define "Body"}}
    <main>
        <div class="container">
            <h1 class="header">Mes Favorites</h1>
            <div id="favorite">
                <div id="favorite-cards-container">
                    {{if gt (len .Fav) 0}}
                        {{range .Fav}}
                            <a class="favorite-card" href="/job/{{if .IsThirdParty}}{{.ThirdPartyId}}?tp=true{{else}}{{.JobId}}?tp=false{{end}}">
                                <h1 class="favorite-title">{{.Title}}</h1>
                                <p class="favorite-addr">{{.Addr}}</p>
                                <div class="metadata">
                                    {{range .Metadata}}
                                        <p class="item">{{.}}</p>
                                    {{end}}
                                </div>
                            </a>
                        {{end}}
                    {{else}}
                        <h1 class="favorite-noitem">Vous n'avez pas de favorite</h1>
                    {{end}}
                </div>
            </div>
            <div>
                <h1 class="header">Mes Postulations</h1>
                <div class="application">
                    {{range $i, $v := .Apps}}
                    <div class="card" data-index="{{$i}}">
                        <h1 class="title">{{$v.Title}}</h1>
                        <p class="application-addr">{{$v.Addr}}</p>
                        <div class="application-footer">
                            <button 
                                type="button" 
                                hx-delete="/mes-postulations" 
                                hx-vals='{"id": "{{$v.Id}}"}'
                                hx-swap="none"
                                hx-target="closest .card"
                                class="cancelBtn">Se retirer</button>
                            <p class='status {{if or (eq $v.Status "Non vue") (eq $v.Status "Vue")}}waiting{{else if eq $v.Status "Reject"}}warning{{else}}validate{{end}}' >{{$v.Status}}</p>
                        </div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </main>
    <script>
        document.body.addEventListener("onDeleteCard", (ev)=>{
            onDeleteCard(ev.target)
        })
        const onDeleteCard = (ele)=>{
            const parent = ele.closest(".card")
            const cards = document.getElementsByClassName("card")
            parent.classList.add("fade")
            for(card of cards){
                if(Number(card.dataset.index) > Number(parent.dataset.index)){
                    card.classList.add("reorder")
                }
            }
            parent.addEventListener("animationend", ()=>{
                parent.remove()
                for(card of cards){
                    if(Number(card.dataset.index) > Number(parent.dataset.index)){
                        card.classList.remove("reorder")
                    }
                }
            })
        }
    </script>
{{end}}
